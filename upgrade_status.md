# Creditcoin 노드 업그레이드 가이드 및 상태

## 버전 정보
- **현재 권장 버전**: 3.61.0-mainnet (최신)
- **이전 버전**: 3.55.0-mainnet
- **문제 버전**: 3.54.0-mainnet (로그 포맷팅 버그 - 건너뛰기)

## 서버 구성
| 서버 | 노드 | 용도 |
|------|------|------|
| D01 | 3node0~3 (4개) | 모니터링 서버 겸 노드 운영 |
| D02 | 3node0~3 (4개) | 노드 운영 |
| M02 | 3node0~3 (4개) | 노드 운영 |

**총 12개 노드**

## 업그레이드 현황

### 2026-02-04 업그레이드 (3.55.0 → 3.61.0)

| 서버 | 노드 | 이전 버전 | 현재 버전 | 상태 |
|------|------|-----------|-----------|------|
| M02 | 3node0 | 3.55.0 | 3.61.0 | 🔄 검증 중 (2/4~) |
| M02 | 3node1 | 3.55.0 | - | ⏳ 대기 |
| M02 | 3node2 | 3.55.0 | - | ⏳ 대기 |
| M02 | 3node3 | 3.55.0 | - | ⏳ 대기 |
| D01 | 3node0 | 3.55.0 | - | ⏳ 대기 |
| D01 | 3node1 | 3.55.0 | - | ⏳ 대기 |
| D01 | 3node2 | 3.55.0 | - | ⏳ 대기 |
| D01 | 3node3 | 3.55.0 | - | ⏳ 대기 |
| D02 | 3node0 | 3.55.0 | - | ⏳ 대기 |
| D02 | 3node1 | 3.55.0 | - | ⏳ 대기 |
| D02 | 3node2 | 3.55.0 | - | ⏳ 대기 |
| D02 | 3node3 | 3.55.0 | - | ⏳ 대기 |

## 업그레이드 절차

### 1. 사전 확인
```bash
# 노드 상태 확인
ssh <서버> "source ~/.zshrc; checkHealth <노드명> && checkVersion <노드명>"

# 예시
ssh M02 "source ~/.zshrc; checkHealth 3node0 && checkVersion 3node0"
```

### 2. 업그레이드 실행
```bash
# 서버 접속
ssh <서버>

# creditcoin-mac 디렉토리로 이동
cd ~/creditcoin-mac

# 업그레이드 실행 (세션키 자동 백업됨)
./addnode.sh <노드번호> --upgrade -v 3.61.0-mainnet

# 예시: 3node0 업그레이드
./addnode.sh 0 --upgrade -v 3.61.0-mainnet
```

### 3. 업그레이드 후 검증
```bash
# 버전 확인
checkVersion <노드명>

# 건강 상태 확인 (peers, syncing)
checkHealth <노드명>

# 세션키 보존 확인 - 업그레이드 시 자동으로 MD5 체크섬 비교됨
# "세션 키가 성공적으로 보존되었습니다" 메시지 확인
```

### 4. 문제 발생 시 복구
```bash
# 세션키 백업 위치 확인
ls ~/creditcoin-mac/3node0_keystore_backup_*

# 백업에서 복구 필요 시
restorekeys <백업파일> <노드명>
```

## 업그레이드 순서 권장

1. **M02 3node0** - 테스트 노드로 먼저 진행
2. 검증 후 M02 나머지 (3node1~3)
3. D02 전체 (3node0~3)
4. D01 전체 (3node0~3) - 모니터링 서버라 마지막

## 주의사항

- **세션키 백업**: 업그레이드 시 자동으로 백업됨 (`{노드명}_keystore_backup_{timestamp}`)
- **중복 키 방지**: 동일 세션키로 여러 노드 실행 시 슬래싱 위험, addnode.sh가 자동 체크
- **동기화 확인**: 업그레이드 후 `isSyncing: false` 확인
- **peers 확인**: 10개 이상 권장

## 완료 후 할 일

- [ ] 모든 노드 업그레이드 완료 확인
- [ ] addnode.sh 기본 버전 3.61.0으로 업데이트 (`VERSION_3X` 변수)
- [ ] 이 문서 최종 상태로 업데이트

---
*최종 업데이트: 2026-02-04*
